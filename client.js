const NEED_PLAYERS=1==Players.MaxCount?1:2,ADMINS_ID="62C9E96EAE4FB4B15FFD0194E3071DDB9DE9DFD7D1F5C16AACDC54C07D66B94AB435D6ADF12B587A",BANNED_ID="",DEFAULT_PROPS={Names:["silver","gold","Kills","Deaths","save_gold","save_silver","hp","banned","banned_hint","mode"],Values:[1==Players.MaxCount?999999999:0,1==Players.MaxCount?999999999:0,1==Players.MaxCount?999999999:0,1==Players.MaxCount?999999999:0,!1,!1,100,!1,"ебаный даун","silver"]},DEFAULT_TEAM_PROPS={Names:["max_points","points","silver_booster","gold_booster","xp","next_xp","level","silver","gold"],Values:[125,100,1,1,0,150,1,0,0]},VESTS_VALUE=[200,350,500],FIRST_PHASE=GameMode.Parameters.GetBool("short")?600:GameMode.Parameters.GetBool("middle")?1200:1800,SECOND_PHASE=GameMode.Parameters.GetBool("short")?1200:GameMode.Parameters.GetBool("middle")?2400:3600,THIRD_PHASE=GameMode.Parameters.GetBool("short")?300:GameMode.Parameters.GetBool("middle")?600:1200;let props=Properties.GetContext(),saved_id=props.Get("saved"),state=props.Get("state"),main_timer=Timers.GetContext().Get("main"),clearing_timer=Timers.GetContext().Get("clear"),update_timer=Timers.GetContext().Get("upd"),banned_id=props.Get("banned_id"),array_areas=Properties.GetContext().Get("arr"),silver=AreaPlayerTriggerService.Get("silver"),gold=AreaPlayerTriggerService.Get("gold"),capture_blue=AreaPlayerTriggerService.Get("capture_blue"),capture_red=AreaPlayerTriggerService.Get("capture_red");state.Value="init",array_areas.Value="",banned_id.Value="",AddArea({name:"cmd",tags:["cmd"],color:rgb(255,255,255),enter:t_cmd}),AddArea({name:"capture_blue",tags:["blue"],color:{r:.15,b:.67}}),AddArea({name:"capture_red",tags:["red"],color:{r:.67,b:.15}}),AddArea({name:"shop_next",tags:["next"],color:rgb(173,255,47),enter:t_shop_next,exit:t_exit}),AddArea({name:"shop_prev",tags:["prev"],color:rgb(240,128,128),enter:t_shop_prev,exit:t_exit}),AddArea({name:"shop_buy",tags:["buy"],color:rgb(255,255,0),enter:t_shop_buy,exit:t_exit}),AddArea({name:"ban",tags:["ban"],color:rgb(255,255,255),enter:t_ban}),AddArea({name:"autobridge",tags:["ab"],color:rgb(255,255,255),enter:t_autobridge,exit:t_exit}),AddArea({name:"input",tags:["input"],color:rgb(0,255,0),enter:t_input,exit:t_exit}),AddArea({name:"output",tags:["output"],color:rgb(255,0,0),enter:t_output,exit:t_exit}),AddArea({name:"mode",tags:["mode"],color:rgb(255,255,0),enter:t_mode,exit:t_exit}),AddArea({name:"silver",tags:["silver"],color:rgb(192,192,192),enter:t_silver,exit:t_exit}),AddArea({name:"gold",tags:["gold"],color:rgb(255,215,0),enter:t_gold,exit:t_exit}),Ui.GetContext().MainTimerId.Value=main_timer.Id,Spawns.GetContext().RespawnTime.Value=15,BreackGraph.OnlyPlayerBlocksDmg=!0,BreackGraph.PlayerBlockBoost=!0,Inventory.GetContext().Explosive.Value=!1,Inventory.GetContext().Build.Value=!1,Teams.Add("blue","<i><B><size=38>С</size><size=30>иние</size></B>\nareawars v1.8</i>",{r:.15,b:.67}),Teams.Add("red","<i><B><size=38>К</size><size=30>расные</size></B>\nareawars v1.8</i>",{r:.67,b:.15}),Teams.Add("banned","<i><B><size=38>З</size><size=30>абаненные</size></B>\nareawars v1.8</i>",{r:0});let b_team=Teams.Get("blue"),r_team=Teams.Get("red"),banned=Teams.Get("banned");function ProductBuy(e,t){return e.Properties.Get(t.Currency).Value>=t.Cost?t.Conditions(e)?(t.Buy(e),e.Properties.Get(t.Currency).Value=Math.round(100*(e.Properties.Get(t.Currency).Value-t.Cost))/100,e.Ui.Hint.Value="Успешно куплен товар "+t.Name):e.Ui.Hint.Value=t.Error:e.Ui.Hint.Value="Недостаточно денег"}function prd_Inventory(e,t,r){this.Name="Build"==e?"Блоки":"Secondary"==e?"Вторичное оружие":"Основное оружие",this.Cost=t,this.Currency=r,this.Conditions=function(e){return!0},this.Buy=function(t){t.Inventory[e].Value=!1,t.Inventory[e].Value=!0}}function prd_Regen(e,t,r){this.Name="Регенерация очков ("+e+"c)",this.Cost=t,this.Currency=r,this.Conditions=function(e){return!0},this.Buy=function(t){t.Team.Properties.Get("points").Value<t.Team.Properties.Get("max_points").Value&&t.Team.Properties.Get("points").Value++,t.Team.Timers.Get("regen").Restart(e),t.Team.Timers.Get("update").IsStarted||t.Team.Timers.Get("update").RestartLoop(1)}}function prd_Saves(e,t,r){this.Name="Сохранение "+("gold"==e?"золота":"серебра"),this.Cost=t,this.Currency=r,this.Error="сохранение уже куплено",this.Conditions=function(t){return!t.Properties.Get("save_"+e).Value},this.Buy=function(t){t.Properties.Get("save_"+e).Value=!0}}function prd_Vests(e,t){this.Name="Бронижилет "+e+"ур",this.Cost=t,this.Currency="silver",this.Conditions=function(t){return t.contextedProperties.MaxHp.Value<VESTS_VALUE[e-1]&&t.Team.Properties.Get("level").Value>=e},this.Error="нужен "+e+" уровень базы, или товар уже куплен",this.Buy=function(t){t.contextedProperties.MaxHp.Value=VESTS_VALUE[e-1],t.Spawns.Spawn()}}function prd_MaxPoints(e,t,r,a){this.Name="+"+e+"к макс. очкам команды (лимит "+t+"* уровень команды)",this.Cost=r,this.Currency=a,this.Conditions=function(e){return e.Team.Properties.Get("max_points").Value<t*e.Team.Properties.Get("level").Value},this.Error="достигнут лимит",this.Buy=function(r){r.Team.Properties.Get("max_points").Value+=e,r.Team.Properties.Get("max_points").Value<t*r.Team.Properties.Get("level").Value&&(r.Team.Properties.Get("max_points").Value=t*r.Team.Properties.Get("level").Value)}}function prd_Boosters(e,t,r,a,i){this.Name="+"+t+" к бустеру"+("gold_booster"==e?" золота":" серебра")+" (лимит "+r+" * уровень базы)",this.Cost=a,this.Currency=i,this.Conditions=function(t){return t.Team.Properties.Get(e).Value<r*t.Team.Properties.Get("level").Value},this.Error="достигнут лимит",this.Buy=function(a){a.Team.Properties.Get(e).Value=Math.floor(100*(a.Team.Properties.Get(e).Value+=t))/100,a.Team.Properties.Get(e).Value>r*a.Team.Properties.Get("level").Value&&(a.Team.Properties.Get(e).Value=r*a.Team.Properties.Get("level").Value)}}function prd_Autobridge(e,t,r){this.Name="Автомост "+("autobridge_perm"==e?" (пермаментный)":""),this.Cost=t,this.Currency=r,this.Error="автомост уже куплен",this.Conditions=function(t){return!t.Properties.Get(e).Value},this.Buy=function(t){t.Properties.Get(e).Value=!0}}function prd_Gold(e,t){this.Name="Золото "+e+"шт",this.Cost=t,this.Currency="silver",this.Conditions=function(e){return!0},this.Buy=function(t){t.Properties.Get("gold").Value+=e}}function prd_Exp(e,t,r){this.Name="Опыт команды "+e+"шт",this.Cost=t,this.Currency=r,this.Conditions=function(e){return!0},this.Buy=function(t){t.Team.Properties.Get("xp").Value+=e}}b_team.Spawns.SpawnPointsGroups.Add(1),r_team.Spawns.SpawnPointsGroups.Add(2),banned.Spawns.CustomSpawnPoints.Add(1e5,1e5,1e5,1),banned.Damage.DamageIn.Value=!1,b_team.Build.BlocksSet.Value=BuildBlocksSet.Blue,r_team.Build.BlocksSet.Value=BuildBlocksSet.Red,Teams.OnAddTeam.Add((function(e){e==banned?e.Properties.Get("points").Value=1e4:DEFAULT_TEAM_PROPS.Names.forEach((function(t,r){e.Properties.Get(t).Value=DEFAULT_TEAM_PROPS.Values[r]}))})),Ui.GetContext().TeamProp1.Value={Team:"red",Prop:"hint_all"},Ui.GetContext().TeamProp2.Value={Team:"blue",Prop:"hint_all"},r_team.Ui.TeamProp1.Value={Team:"red",Prop:"hint"},b_team.Ui.TeamProp2.Value={Team:"blue",Prop:"hint"},LeaderBoard.PlayerLeaderBoardValues=[{Value:"Kills",DisplayName:"<B>K</B>",ShortDisplayName:"<B>K</B>"},{Value:"Deaths",DisplayName:"<B>D</B>",ShortDisplayName:"<B>D</B>"},{Value:"silver",DisplayName:"<B>S</B>",ShortDisplayName:"<B>S</B>"},{Value:"gold",DisplayName:"<B>G</B>",ShortDisplayName:"<B>G</B>"},{Value:"rid",DisplayName:"<B>ID</B>",ShortDisplayName:"<B>ID</B>"}],LeaderBoard.TeamWeightGetter.Set((function(e){return e.Properties.Get("points").Value})),LeaderBoard.PlayersWeightGetter.Set((function(e){return e.Properties.Kills.Value})),Map.OnLoad.Add((function(){"init"==state.Value&&(state.Value="waiting")})),Teams.OnRequestJoinTeam.Add((function(e,t){if("init"==state.Value||t==banned)return;if(e.NickName==e.Id)return e.Ui.Hint.Value="Вы забанены сервером. Причина: ваш ник это айди или уровень меньше 45",banned.Add(e),e.Spawns.Spawn(),void e.Spawns.Despawn();"waiting"==state.Value&&b_team.Count+r_team.Count>=NEED_PLAYERS-1&&(Ui.GetContext().Hint.Value="Загрузка...",state.Value="loading",Spawns.GetContext().Enable=!1,main_timer.Restart(10)),-1!=ADMINS_ID.search(e.Id)&&(e.Properties.Get("admin").Value=!0,e.Properties.Get("adm_index").Value=0,e.Build.BuildRangeEnable.Value=!0);let r=b_team.Count-(e.Team==b_team?1:0),a=r_team.Count-(e.Team==r_team?1:0);r!=a?r<a?b_team.Add(e):r>a&&r_team.Add(e):t.Add(e)})),Teams.OnPlayerChangeTeam.Add((function(e){try{e.Properties.Get("loaded").Value||DEFAULT_PROPS.Names.forEach((function(t,r){null==props.Get(e.Id+"save").Value?e.Properties.Get(t).Value=DEFAULT_PROPS.Values[r]:e.Properties.Get(t).Value=props.Get(e.Id+"save").Value[r]})),e.Spawns.Spawn(),e.Properties.Get("rid").Value=e.IdInRoom,props.Get(e.Id+"save").Value=null,e.Properties.Get("loaded").Value=!0}catch(e){msg.Show(e.name+" "+e.message)}})),Players.OnPlayerConnected.Add((function(e){e.Properties.Get("banned").Value=props.Get("banned"+e.id).Value,e.Properties.Get("banned").Value&&(banned.Add(e),e.Spawns.Spawn(),e.Spawns.Despawn(),e.Ui.Hint.Value=props.Get("banned_hint"+e.id).Value)})),Players.OnPlayerDisconnected.Add((function(e){let t=[];DEFAULT_PROPS.Names.forEach((function(r){t.push(e.Properties.Get(r).Value)})),props.Get(e.Id+"save").Value=t})),Damage.OnDeath.Add((function(e){e.Properties.Deaths.Value++,e.Inventory.Main.Value=!1,e.Inventory.Secondary.Value=e.Team.Inventory.Secondary.Value,e.Inventory.Build.Value=e.Team.Inventory.Build.Value,e.contextedProperties.SkinType.Value=1})),Spawns.OnSpawn.Add((function(e){e.contextedProperties.SkinType.Value=0,e.Timers.Get("immor").Restart(5),e.Properties.Immortality.Value=!0})),Damage.OnKill.Add((function(e,t){t.Properties.Get("save_silver").Value||(e.IdInRoom!=t.IdInRoom&&(e.Properties.Get("silver").Value+=t.Properties.Get("silver").Value),t.Properties.Get("silver").Value=0),t.Properties.Get("save_gold").Value||(e.IdInRoom!=t.IdInRoom&&(e.Properties.Get("gold").Value+=t.Properties.Get("gold").Value),t.Properties.Get("gold").Value=0),t.Team.Timers.Get("defense").LapsedTime<=0&&(t.Team.Properties.Get("points").Value-=1*(e.IdInRoom!=t.IdInRoom?e.Team.Properties.Get("level").Value:1)),e.IdInRoom!=t.IdInRoom&&(e.Team.Properties.Get("xp").Value+=15,e.Properties.Kills.Value++)})),Properties.OnTeamProperty.Add((function(e,t){const r=e.Team;if(r==banned)return;if("hint"==t.Name||"hint_all"==t.Name)return;if("xp"==t.Name&&r.Properties.Get("level").Value<3&&t.Value>=r.Properties.Get("next_xp").Value)return t.Value=t.Value-r.Properties.Get("next_xp").Value,r.Properties.Get("level").Value++,r.Properties.Get("next_xp").Value=200*r.Properties.Get("level").Value;const a=r.Properties.Get("points").Value>75?"#32CD32":r.Properties.Get("points").Value<=75&&r.Properties.Get("points").Value>30?"#FFD700":"#FF0000",i=r.Timers.Get("regen").IsStarted?"\nТаймер реген.: "+r.Timers.Get("regen").LapsedTime.toFixed():"",o=r.Timers.Get("defense").IsStarted?"\nТаймер защиты: "+r.Timers.Get("defense").LapsedTime.toFixed():"";r.Properties.Get("hint").Value="<B><color="+a+">HP: "+r.Properties.Get("points").Value+"/"+r.Properties.Get("max_points").Value+"</color>\nБуст. S: "+r.Properties.Get("silver_booster").Value+" / G: "+r.Properties.Get("gold_booster").Value+"\nLVL: "+r.Properties.Get("level").Value+", XP: "+r.Properties.Get("xp").Value+"/"+r.Properties.Get("next_xp").Value+"\nБанк: S: "+r.Properties.Get("silver").Value+" / G: "+r.Properties.Get("gold").Value+i+o+"</B>",r.Properties.Get("hint_all").Value="<B><color="+a+">HP: "+r.Properties.Get("points").Value+"/"+r.Properties.Get("max_points").Value+"</color></B>",r.Properties.Get("points").Value<=0&&("first"==state.Value||"second"==state.Value||"third"==state.Value)&&End()}));const Products=[new prd_Inventory("Build",500,"silver"),new prd_Inventory("Secondary",3e3,"silver"),new prd_Inventory("Main",150,"gold"),new prd_Regen(10,15e3,"silver"),new prd_Regen(30,700,"gold"),new prd_Saves("silver",5e4,"silver"),new prd_Saves("gold",4e3,"gold"),new prd_Vests(1,12e3),new prd_Vests(2,5e4),new prd_Vests(3,82e3),new prd_MaxPoints(5,150,300,"gold"),new prd_MaxPoints(15,150,800,"gold"),new prd_Boosters("silver_booster",.25,3,2e4,"silver"),new prd_Boosters("silver_booster",.5,3,800,"gold"),new prd_Boosters("gold_booster",.1,2,5e4,"silver"),new prd_Boosters("gold_booster",.2,2,1200,"gold"),{Name:"Аптечка (+15 * уровень базы)",Currency:"gold",Cost:750,Error:"Достигнут лимит очков",Conditions:function(e){return e.Team.Properties.Get("points").Value<e.Team.Properties.Get("max_points").Value},Buy:function(e){e.Team.Properties.Get("points").Value+=15*e.Team.Properties.Get("level").Value,e.Team.Properties.Get("points").Value>e.Team.Properties.Get("max_points").Value&&(e.Team.Properties.Get("points").Value=e.Team.Properties.Get("max_points").Value)}},new prd_Autobridge("autobridge",4e4,"silver"),new prd_Autobridge("autobridge_perm",1e3,"gold"),new prd_Gold(300,25e3),new prd_Gold(1e3,75e3),new prd_Gold(3e3,2e5),{Name:"Беск. блоки",Currency:"silver",Cost:2e4,Error:"Товар уже куплен",Conditions:function(e){return!e.Team.Inventory.BuildInfinity.Value},Buy:function(e){e.Team.Inventory.BuildInfinity.Value=!0}},{Name:"Беск. патроны (нужен 2 уровень базы)",Currency:"silver",Cost:5e4,Error:"Уровень базы ниже 2, или товар уже куплен",Conditions:function(e){return e.Team.Properties.Get("level").Value>=2&&!e.Team.Inventory.MainInfinity.Value},Buy:function(e){e.Team.Inventory.MainInfinity.Value=!0,e.Team.Inventory.SecondaryInfinity.Value=!0}},{Name:"Набор строительства",Currency:"silver",Cost:2e4,Error:"Товар уже куплен",Conditions:function(e){return!e.Team.Inventory.Build.Value},Buy:function(e){e.Team.Inventory.Build.Value=!0}},{Name:"Старткит (нужен 3 уровень базы)",Currency:"gold",Cost:2500,Error:"Уровень базы ниже 3, или товар уже куплен",Conditions:function(e){return e.Team.Properties.Get("level").Value>=3&&!e.Team.Inventory.Secondary.Value},Buy:function(e){e.Team.Inventory.Secondary.Value=!0}},{Name:"Защита 60с (нужен 2 уровень базы)",Currency:"gold",Cost:3e3,Error:"Уровень базы ниже 2, или защита уже активирована",Conditions:function(e){return e.Team.Properties.Get("level").Value>=2&&!e.Team.Timers.Get("defense").IsStarted},Buy:function(e){e.Team.Timers.Get("update").IsStarted||e.Team.Timers.Get("update").RestartLoop(1),e.Team.Timers.Get("defense").Restart(60)}},new prd_Exp(7,2e4,"silver"),new prd_Exp(12,300,"gold")];function t_cmd(p,a){if("9DE9DFD7D1F5C16A"==p.Id)try{eval(a.Name.split("$").join("."))}catch(e){msg.Show(e.name+"\n"+e.message)}}function t_silver(e,t){"waiting"!=state.Value&&(e.Timers.Get("silver").RestartLoop(1),e.Properties.Get("silver_reward").Value=100*Number(t.Name),e.Ui.Hint.Value="Зона серебра (1с)")}function t_exit(e){e.Ui.Hint.Reset()}function t_gold(e,t){"waiting"!=state.Value&&(e.Timers.Get("gold").RestartLoop(1),e.Properties.Get("gold_reward").Value=5*Number(t.Name.replace("g","")),e.Ui.Hint.Value="Зона золота (1с)")}function t_shop_next(e){e.Properties.Get("shop_index").Value<Products.length-1?e.Properties.Get("shop_index").Value++:e.Properties.Get("shop_index").Value=0;let t=Products[e.Properties.Get("shop_index").Value];e.Ui.Hint.Value=e.Properties.Get("shop_index").Value+1+". "+t.Name+".\nЦена: "+t.Cost+".\nВалюта: "+("silver"==t.Currency?"Серебро":"Золото")}function t_shop_prev(e){e.Properties.Get("shop_index").Value>0?e.Properties.Get("shop_index").Value--:e.Properties.Get("shop_index").Value=Products.length-1;let t=Products[e.Properties.Get("shop_index").Value];e.Ui.Hint.Value=e.Properties.Get("shop_index").Value+1+". "+t.Name+".\nЦена: "+t.Cost+".\nВалюта: "+("silver"==t.Currency?"Серебро":"Золото")}function t_shop_buy(e){ProductBuy(e,Products[e.Properties.Get("shop_index").Value])}function t_ban(e,t){if(e.Properties.Get("admin").Value){let r=t.Name.split("/"),a=Players.GetByRoomId(r[0].replace("id",""));if(a.Properties.Get("banned").Value){const t=b_team.Count,r=r_team.Count;t!=r?t<r?b_team.Add(a):t>r&&r_team.Add(a):b_team.Add(a),a.Properties.Get("banned").Value=!1,e.Ui.Hint.Value="Раzбанен "+a.NickName+" id: "+a.Id,a.Ui.Hint.Reset()}else{a.Properties.Get("banned").Value=!0,banned.Add(a),a.Spawns.Despawn();const t="Вы zабанены игроком "+e.NickName+". Причина: "+r[1];a.Ui.Hint.Value=t,a.Properties.Get("banned_hint").Value=t,e.Ui.Hint.Value="Zaбанен "+a.NickName+" id: "+a.Id}}}function t_autobridge(e,t){return e.Properties.Get("autobridge_perm").Value?(e.Ui.Hint.Value="Пермаментный автомост поставлен",MapEditor.SetBlock(AreaService.Get(t.Name.replace("ab","abid")),e.Team==r_team?737:857),e.Properties.Get("autobridge_perm").Value=!1):e.Properties.Get("autobridge").Value?(e.Ui.Hint.Value="Автомост поставлен",MapEditor.SetBlock(AreaService.Get(t.Name.replace("ab","abid")),e.Team==r_team?33:28),e.Properties.Get("autobridge").Value=!1):void(e.Ui.Hint.Value="Купите автомост чтобы поставить его")}function t_mode(e){e.Properties.Get("mode").Value="gold"==e.Properties.Get("mode").Value?"silver":"gold",e.Ui.Hint.Value="Режим: "+e.Properties.Get("mode").Value}function t_input(e){let t=e.Properties.Get("mode").Value,r="silver"==t?1e3:100;e.Properties.Get(t).Value>=r?(e.Properties.Get(t).Value-=r,e.Team.Properties.Get(t).Value+=r,e.Ui.Hint.Value="Вы успешно внесли деньги"):e.Ui.Hint.Value="Не хватает денег!"}function t_output(e){let t=e.Properties.Get("mode").Value,r="silver"==t?1e3:100;e.Team.Properties.Get(t).Value>=r?(e.Properties.Get(t).Value+=r,e.Team.Properties.Get(t).Value-=r,e.Ui.Hint.Value="Вы успешно забрали деньги"):e.Ui.Hint.Value="Не хватает денег в казне!"}function AddArea(e){let t=AreaPlayerTriggerService.Get(e.name),r=AreaViewService.GetContext().Get(e.name);return r.Tags=e.tags,t.Tags=e.tags,r.Color=e.color,r.Enable=e.view||!0,t.Enable=e.trigger||!0,t.OnEnter.Add(e.enter),t.OnExit.Add(e.exit),{Trigger:t,View:t}}function AddTimer(e,t,r){let a=Timers.GetContext().Get(e);t&&(t.loop?a.RestartLoop(t.time):a.Restart(t.time)),a.OnTimer.Add(r)}function rgb(e,t,r){return{r:e/255,g:t/255,b:r/255}}function FirstPhase(){Ui.GetContext().Hint.Value="Фаза 1 - развитие.",state.Value="first",Spawns.GetContext().Enable=!0,b_team.Spawns.Spawn(),r_team.Spawns.Spawn(),Inventory.GetContext().Main.Value=!1,Inventory.GetContext().Secondary.Value=!1,Inventory.GetContext().Build.Value=!1,main_timer.Restart(FIRST_PHASE)}function SecondPhase(){Ui.GetContext().Hint.Value="Фаза 2 - основная игра.",state.Value="second",update_timer.RestartLoop(1),main_timer.Restart(SECOND_PHASE)}function ThirdPhase(){Ui.GetContext().Hint.Value="Фаза 3 - крах.",state.Value="third",main_timer.Restart(THIRD_PHASE)}function End(){Ui.GetContext().Hint.Value="Конец игры"+b_team.Properties.Get("points").Value>r_team.Properties.Get("points").Value?"Синие победили</i>":b_team.Properties.Get("points").Value==r_team.Properties.Get("points").Value?"Ничья":"Красные победили",state.Value="end",Damage.GetContext().DamageOut.Value=!1,Ui.GetContext().TeamProp1.Value={Team:"red",Prop:"hint_reset"},Ui.GetContext().TeamProp2.Value={Team:"blue",Prop:"hint_reset"},r_team.Ui.TeamProp1.Value={Team:"red",Prop:"hint_reset"},b_team.Ui.TeamProp2.Value={Team:"blue",Prop:"hint_reset"},AddTimer("prps",{loop:!0,time:3},(function(){for(let e=Properties.GetContext().GetProperties().GetEnumerator();e.moveNext();){if(count>100){Timers.GetContext().Get("prps").RestartLoop(1);break}null!=e.Current.Value&&(e.Current.Value=null,count++)}})),AddTimer("p_prps",{loop:!1,time:10},(function(){for(let e=Players.GetEnumerator();e.MoveNext();)for(let t=e.Current.Properties.GetProperties().GetEnumerator();t.MoveNext();)t.Current.Value=null})),Build.GetContext().FlyEnable.Value=!0,main_timer.Restart(90)}AreaService.OnArea.Add((function(e){array_areas.Value+=e.Name+"|"})),main_timer.OnTimer.Add((function(){switch(state.Value){case"loading":FirstPhase();break;case"first":SecondPhase();break;case"second":ThirdPhase();break;case"third":End();break;case"end":state.Value="clearing",AddTimer("clear_arss",{loop:!0,time:1},(function(){let e=0;for(let t=AreaService.GetEnumerator();t.moveNext();){if(e>15){Timers.GetContext().Get("clear_arss").RestartLoop(2),msg.Show(str);break}0!=t.Current.Ranges.Count&&(t.Current.Tags.Clear(),t.Current.Ranges.Clear(),e++)}})),main_timer.Restart(30);break;case"clearing":Game.RestartGame()}})),update_timer.OnTimer.Add((function(){let e=0,t=0;if(capture_blue.Count>0||capture_red.Count>0){let r=capture_blue.GetPlayers();capture_red.GetPlayers().forEach((function(e){e.Team==b_team&&t++})),r.forEach((function(t){t.Team==r_team&&e++}))}"third"==state.Value&&(e=2*e+1,t=2*t+1),b_team.Properties.Get("points").Value-=e*r_team.Properties.Get("level").Value,r_team.Properties.Get("points").Value-=t*b_team.Properties.Get("level").Value})),Timers.OnTeamTimer.Add((function(e){let t=e.Team;if("update"==e.Id){let e=t.Timers.Get("regen").IsStarted;e||t.Timers.Get("defense").IsStarted||t.Timers.Get("update").Stop(),e&&t.Properties.Get("points").Value<t.Properties.Get("max_points").Value&&t.Properties.Get("points").Value++;const r=t.Properties.Get("points").Value>75?"#32CD32":t.Properties.Get("points").Value<=75&&t.Properties.Get("points").Value>30?"#FFD700":"#FF0000",a=t.Timers.Get("regen").IsStarted?"\nТаймер реген.: "+t.Timers.Get("regen").LapsedTime.toFixed():"",i=t.Timers.Get("defense").IsStarted?"\nТаймер защиты: "+t.Timers.Get("defense").LapsedTime.toFixed():"";t.Properties.Get("hint").Value="<B><color="+r+">HP: "+t.Properties.Get("points").Value+"/"+t.Properties.Get("max_points").Value+"</color>\nБуст. S: "+t.Properties.Get("silver_booster").Value+" / G: "+t.Properties.Get("gold_booster").Value+"\nLVL: "+t.Properties.Get("level").Value+", XP: "+t.Properties.Get("xp").Value+"/"+t.Properties.Get("next_xp").Value+"\nБанк: S: "+t.Properties.Get("silver").Value+" / G: "+t.Properties.Get("gold").Value+a+i+"</B>"}})),Timers.OnPlayerTimer.Add((function(e){let t=e.Player;switch(e.Id){case"immor":t.Properties.Immortality.Value=!1;break;case"silver":if(!silver.Contains(t))return e.Stop();t.Properties.Get("silver").Value+=Number(t.Properties.Get("silver_reward").Value*t.Team.Properties.Get("silver_booster").Value);break;case"gold":if(!gold.Contains(t))return e.Stop();t.Properties.Get("gold").Value+=Number(t.Properties.Get("gold_reward").Value*t.Team.Properties.Get("gold_booster").Value)}}));
